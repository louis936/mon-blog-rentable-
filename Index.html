<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ma Boutique AffiliÃ©e CJ</title>
  <meta name="description" content="Affichage dynamique et comparatif de produits affiliÃ©s via CJ Affiliate">
  
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
  /* =====================
     VARIABLES GLOBALES
  ===================== */
  :root {
    --clr-primary: #007aff;
    --clr-secondary: #f5f5f5;
    --clr-dark: #222;
    --clr-light: #fff;
    --radius: 8px;
    --transition: 0.3s ease;
    --font-base: 'Poppins', sans-serif;
  }
  [data-theme="dark"] {
    --clr-primary: #66aaff;
    --clr-secondary: #1a1a1a;
    --clr-dark: #eee;
    --clr-light: #222;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:var(--font-base); background:var(--clr-secondary); color:var(--clr-dark); transition: background var(--transition), color var(--transition); }
  a { color:var(--clr-primary); text-decoration:none; }
  img { max-width:100%; display:block; }
  button { background: var(--clr-primary); color: var(--clr-light); border: none; border-radius: var(--radius); padding: 0.6em 1em; cursor: pointer; transition: background var(--transition); }
  button:hover { background: darken(var(--clr-primary),10%); }

  /* =====================
     HEADER & NAV
  ===================== */
  header { position: sticky; top: 0; left: 0; width: 100%; background: var(--clr-light); box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 100; }
  .nav-container { max-width: 1200px; margin:auto; display:flex; justify-content:space-between; align-items:center; padding: 1em; }
  nav ul { display:flex; gap:1em; list-style:none; }

  /* =====================
     GRILLE DE PRODUITS
  ===================== */
  #results { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:1.5em; }
  .card { background: var(--clr-light); border-radius: var(--radius); overflow:hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
  .card img { aspect-ratio:4/3; object-fit:cover; }
  .card-content { padding:1em; flex:1; }
  .card-title { font-size:1em; font-weight:bold; margin-bottom:0.5em; }
  .card-price { color: var(--clr-primary); font-weight:700; margin-bottom:0.5em; }
  .compare-btn { margin-top:auto; }

  /* =====================
     COMPARATEUR DE PRODUITS
  ===================== */
  #compare-container { display:none; background: var(--clr-light); padding:1em; border-radius: var(--radius); box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-top:1.5em; }
  #compare-table { width:100%; border-collapse: collapse; }
  #compare-table th, #compare-table td { padding:0.8em; border-bottom: 1px solid #ddd; text-align:left; }

  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="nav-container">
      <div class="logo">CJ Affiliation</div>
      <nav>
        <ul>
          <li><a href="#">Accueil</a></li>
          <li><a href="#about">Ã€ propos</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><button id="theme-toggle">ðŸŒ™</button></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- SECTION PRODUITS -->
  <section>
    <div id="results"></div>
  </section>

  <!-- COMPARATEUR DE PRODUITS -->
  <section id="compare-container">
    <h2>Comparer les produits</h2>
    <table id="compare-table">
      <thead>
        <tr><th>Produit</th><th>Prix</th><th>CatÃ©gorie</th><th>Lien</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
  /* ================================
     CONFIG API CJ
  ================================ */
  const API_KEY = "9UJdqflU6NsT0JW_z6bAqogATA";
  const SITE_ID = "7587661";  
  const BASE_URL = "https://api.cj.com/v3/product-search";

  /* THEME SWITCH */
  const themeToggle = document.getElementById("theme-toggle");
  themeToggle.onclick = () => {
    document.documentElement.dataset.theme = document.documentElement.dataset.theme === "dark" ? "light" : "dark";
    localStorage.setItem("theme", document.documentElement.dataset.theme);
  };

  /* FETCH PRODUCTS */
  async function fetchProducts() {
    const response = await fetch(`${BASE_URL}?query=tech&website-id=${SITE_ID}`, { headers: { "Authorization": `Bearer ${API_KEY}` } });
    const data = await response.json();
    renderProducts(data.products);
  }

  function renderProducts(products) {
    const results = document.getElementById("results");
    results.innerHTML = "";
    products.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<img src="${p.image-url}" alt="${p.name}">
        <div class="card-content">
          <h3 class="card-title">${p.name}</h3>
          <p class="card-price">${p.price} ${p.currency}</p>
          <button class="compare-btn" data-product='${JSON.stringify(p)}'>Comparer</button>
        </div>`;
      results.appendChild(card);
    });

    document.querySelectorAll(".compare-btn").forEach(btn => {
      btn.onclick = () => addToCompare(JSON.parse(btn.dataset.product));
    });
  }

  /* COMPARATEUR */
  const compareTable = document.getElementById("compare-table").querySelector("tbody");
  function addToCompare(product) {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${product.name}</td><td>${product.price} ${product.currency}</td><td>${product.category}</td>
                     <td><a href="${product.buyUrl}" target="_blank">Voir</a></td>`;
    compareTable.appendChild(row);
    document.getElementById("compare-container").style.display = "block";
  }

  fetchProducts();
  </script>

</body>
</html>